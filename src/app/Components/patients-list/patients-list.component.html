
<div class="patient-list-container">
    <!-- Header -->
    <div class="header">
    <h2>Patient Management System</h2>
    <div class="header-actions">
        <button class="btn btn-primary" (click)="navigateToAddPatient()">
        <i class="icon-plus"></i> Add New Patient
        </button>
        <button class="btn btn-secondary" (click)="refreshList()">
        <i class="icon-refresh"></i> Refresh
        </button>
    </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-section">
    <div class="search-row">
        <div class="search-group">
        <label>Search Patient:</label>
        <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            placeholder="Enter patient name, ID, or father's name..."
            class="search-input"
            (input)="onSearch()"
        >
        </div>
        
        <div class="filter-group">
        <label>Date Range:</label>
        <input 
            type="date" 
            [(ngModel)]="dateFrom" 
            class="date-input"
            (change)="onDateFilter()"
        >
        <span>to</span>
        <input 
            type="date" 
            [(ngModel)]="dateTo" 
            class="date-input"
            (change)="onDateFilter()"
        >
        </div>

        <div class="filter-group">
        <label>Status:</label>
        <select [(ngModel)]="statusFilter" (change)="onStatusFilter()" class="select-input">
            <option value="">All Status</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In&#160;Progress</option>
            <option value="Completed">Completed</option>
        </select>
        </div>
    </div>

    <div class="stats-row">
        <div class="stat-card">
        <span class="stat-number">{{filteredPatients.length}}</span>
        <span class="stat-label">Total Patients</span>
        </div>
        <div class="stat-card">
        <span class="stat-number">{{getTotalAmount()}}</span>
        <span class="stat-label">Total Amount</span>
        </div>
        <div class="stat-card">
        <span class="stat-number">{{getPendingCount()}}</span>
        <span class="stat-label">Pending Reports</span>
        </div>
    </div>
    </div>

    <!-- Table -->
    <div class="table-container">
        <!-- Loading Spinner -->
        <div *ngIf="isLoading" class="loading-message">
            Loading patients...
        </div>
        <!-- Empty State -->
        <div *ngIf="!isLoading && filteredPatients.length === 0" class="empty-message">
            No patients found.
        </div>
        <table *ngIf="!isLoading && filteredPatients.length > 0" class="patients-table">
            <thead>
                <tr>
                    
                    <!-- <th (click)="sort('serialNo')" class="sortable">
                    S.No
                    <i class="sort-icon" [class]="getSortIcon('serialNo')"></i>
                    </th> -->
                    <th (click)="sort('patient_DOB')" class="sortable">
                    Date Of Birth
                    <i class="sort-icon" [class]="getSortIcon('patient_DOB')"></i>
                    </th>
                    <th (click)="sort('patient_Name')" class="sortable">
                    Patient Name / Father Name
                    <i class="sort-icon" [class]="getSortIcon('patient_Name')"></i>
                    </th>
                    <th (click)="sort('patient_Age')" class="sortable">
                    Age/Sex
                    <i class="sort-icon" [class]="getSortIcon('patient_Age')"></i>
                    </th>
                    <th>Alt Ref.No / Permanent ID</th>
                    <th>Referred By Lab / Dr</th>
                    <!-- <th (click)="sort('receipt')" class="sortable">
                    Receipt
                    <i class="sort-icon" [class]="getSortIcon('receipt')"></i>
                    </th>
                    <th>Urg Rep</th>
                    <th>Chk Print</th>
                    <th (click)="sort('total_Amount')" class="sortable">
                    Total Amt
                    <i class="sort-icon" [class]="getSortIcon('total_Amount')"></i>
                    </th>
                    <th (click)="sort('discount')" class="sortable">
                    Disc
                    <i class="sort-icon" [class]="getSortIcon('discount')"></i>
                    </th>
                    <th (click)="sort('net_Amount')" class="sortable">
                    Net Amt
                    <i class="sort-icon" [class]="getSortIcon('net_Amount')"></i>
                    </th> -->
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
        <tbody>
        <tr *ngFor="let patient of paginatedPatients; let i = index" 
            [class]="getRowClass(patient)">
            <!-- <td>{{patient.serialNo}}</td> -->
            
            <td>{{formatDate(patient.patient_DOB)}}</td>
            <td>
            <div class="patient-info">
                <strong>{{patient.patient_Name}}</strong>
                <small>{{patient.relative_Name}}</small>
            </div>
            </td>
            <td>{{patient.patient_Age}}/{{patient.patient_Gender}}</td>
            <td>
            <!-- <div class="ref-info">
                <div>{{patient.altRefNo || '-'}}</div>
                <small>{{patient.permanent_Id || '-'}}</small>
            </div> -->
            </td>
            <td>
            <div class="ref-info">
                <!-- <div>{{patient.referredByLab || '-'}}</div> -->
                <!-- <small>{{patient.referred_By || '-'}}</small> -->
            </div>
            </td>
            <!-- <td>{{patient.receipt}}</td> -->
            <td>
            <!-- <span class="badge" [class]="patient.urgent_Report === 'Yes' ? 'badge-urgent' : 'badge-normal'">
                {{patient.urgent_Report}}
            </span> -->
            </td>
            <td>
            <!-- <span class="badge" [class]="patient.check_Print === 'Yes' ? 'badge-success' : 'badge-pending'">
                {{patient.check_Print}}
            </span> -->
            </td>
            <!-- <td class="amount">₹{{patient.total_Amount}}</td>
            <td class="amount">₹{{patient.discount}}</td>
            <td class="amount">₹{{patient.net_Amount}}</td> -->
            <td>
            <!-- <span class="status-badge" [class]="getStatusClass(patient.status)">
                {{patient.status}}
            </span> -->
            </td>
            <td>
            <div class="action-buttons">
                <button class="btn-action btn-view" (click)="viewPatient(patient.patient_Id)" title="View">
                <i class="icon-eye"></i>
                </button>
                <button class="btn-action btn-edit" (click)="editPatient(patient.patient_Id)" title="Edit">
                <i class="icon-edit"></i>
                </button>
                <button class="btn-action btn-print" (click)="printReport(patient.patient_Id)" title="Print">
                <i class="icon-print"></i>
                </button>
                <button class="btn-action btn-delete" (click)="deletePatient(patient.patient_Id)" title="Delete">
                <i class="icon-trash"></i>
                </button>
            </div>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- No Data Message -->
    <div *ngIf="filteredPatients.length === 0" class="no-data">
        <i class="icon-info"></i>
        <p>No patients found matching your criteria.</p>
    </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="filteredPatients.length > 0">
    <div class="pagination-info">
        Showing {{startIndex + 1}} to {{endIndex}} of {{filteredPatients.length}} patients
    </div>
    <div class="pagination-controls">
        <select [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="page-size-select">
        <option value="10">10 per page</option>
        <option value="25">25 per page</option>
        <option value="50">50 per page</option>
        <option value="100">100 per page</option>
        </select>
        
        <button class="btn-page" [disabled]="currentPage === 1" (click)="goToPage(1)">First</button>
        <button class="btn-page" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">Previous</button>
        
        <span class="page-numbers">
        <button 
            *ngFor="let page of getVisiblePages()" 
            class="btn-page"
            [class.active]="page === currentPage"
            (click)="goToPage(page)">
            {{page}}
        </button>
        </span>
        
        <button class="btn-page" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">Next</button>
        <button class="btn-page" [disabled]="currentPage === totalPages" (click)="goToPage(totalPages)">Last</button>
    </div>
    </div>
</div>